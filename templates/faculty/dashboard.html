<!DOCTYPE html>
<html>
<head>
    <title>Faculty Dashboard</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: linear-gradient(to right, #e3f2fd, #f8f9fa);
        }

        .navbar {
            background-color: #0d6efd;
            color: white;
            padding: 12px;
        }

        .card {
            border-radius: 15px;
        }

        .table th {
            background-color: #0d6efd;
            color: white;
        }

        textarea {
            resize: none;
        }

        .similarity-low {
            color: green;
            font-weight: bold;
        }

        .similarity-medium {
            color: orange;
            font-weight: bold;
        }

        .similarity-high {
            color: red;
            font-weight: bold;
        }
    </style>
</head>

<body>

<!-- NAVBAR -->
<div class="navbar d-flex justify-content-between">
    <h5 class="ms-3 mb-0">üë©‚Äçüè´ Faculty Dashboard - {{ session['department'] }}</h5>
    <a href="/logout" class="btn btn-light btn-sm me-3">Logout</a>
</div>

<div class="container mt-4">

    <div class="card shadow p-3">
        <h4 class="mb-3">üìò Faculty Evaluation Panel</h4>

        <div class="table-responsive">
            <table class="table table-bordered text-center align-middle">

                <thead>
                    <tr>
                        <th>Student Name</th>
                        <th>Roll No</th>
                        <th>Project Title</th>
                        <th>Description</th>
                        <th>Similarity %</th>
                        <th>View File</th>
                        <th>Marks</th>
                        <th>Feedback</th>
                        <th>Status</th>
                        <th>Submit</th>
                    </tr>
                </thead>

                <tbody>
                {% for p in projects %}
                <tr>

                    <form method="POST" action="{{ url_for('faculty_evaluate', project_id=p.id) }}">

                        <td>{{ p.name }}</td>
                        <td>{{ p.roll_no }}</td>
                        <td>{{ p.title }}</td>
                        <td style="max-width:200px;">{{ p.description }}</td>

                        <!-- Similarity Badge -->
                        <td>
                            {% if p.similarity_percentage < 30 %}
                                <span class="similarity-low">{{ p.similarity_percentage }}%</span>
                            {% elif p.similarity_percentage < 60 %}
                                <span class="similarity-medium">{{ p.similarity_percentage }}%</span>
                            {% else %}
                                <span class="similarity-high">{{ p.similarity_percentage }}%</span>
                            {% endif %}
                        </td>

                        <!-- File View -->
                        <td>
                            <a href="{{ url_for('uploaded_file', filename=p.file_path) }}" 
                               class="btn btn-primary btn-sm" target="_blank">
                               View
                            </a>
                        </td>

                        <!-- Marks -->
                        <td>
                            <input type="number" 
                                   name="marks" 
                                   class="form-control"
                                   min="0" max="100"
                                   value="{{ p.marks if p.marks else '' }}"
                                   {% if p.status == 'Evaluated' %} disabled {% endif %}
                                   required>
                        </td>

                        <!-- Feedback -->
                        <td>
                            <input type="text" 
                                   name="feedback" 
                                   class="form-control"
                                   value="{{ p.feedback if p.feedback else '' }}"
                                   {% if p.status == 'Evaluated' %} disabled {% endif %}
                                   required>
                        </td>

                        <!-- Status -->
                        <td>
                            {% if p.status == 'Evaluated' %}
                                <span class="badge bg-success">Evaluated</span>
                            {% elif p.status == 'Flagged' %}
                                <span class="badge bg-danger">Flagged</span>
                            {% else %}
                                <span class="badge bg-warning text-dark">Pending</span>
                            {% endif %}
                        </td>

                        <!-- Submit Button -->
                        <td>
                            {% if p.status != 'Evaluated' %}
                                <button type="submit" class="btn btn-success btn-sm">
                                    Submit
                                </button>
                            {% else %}
                                <button class="btn btn-secondary btn-sm" disabled>
                                    Locked
                                </button>
                            {% endif %}
                        </td>
                        <input type="number" name="marks" value="{{ p.marks if p.marks else '' }}" class="form-control" required>

                        <input type="text" name="feedback" value="{{ p.feedback if p.feedback else '' }}" class="form-control" required>

                    </form>

                </tr>
                {% endfor %}
                </tbody>

            </table>
        </div>
    </div>

</div>

</body>
</html>